# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see https://i3wm.org/docs/userguide.html for a complete reference!

################################################################################

# Dicas/tips:
# xmodmap in terminal to see all possibilities
# xmodmap -pke to show keycodes
# https://thevaluable.dev/i3-config-mouseless/
# https://github.com/alberto-santini/i3-configuration-x1/blob/master/README.md

# Dependencies:
# i3 blocks at least version 1.5
# Fonts Awesome
# Flameshot
# alacritty
# For some blocklets, docker and dunst I guess
# In order for the brightness blocklet to work as it is configured now, it is
# necessary to create a sudoer file (eg /etc/sudoers.d/xbacklight) and give your
# user the hability to run xbacklight without password:
# user ALL=(ALL) NOPASSWD: /user/bin/xbacklight
# In doubt, check the documentation here: https://github.com/vivien/i3blocks-contrib/tree/master/backlight

################################################################################
### ---------------- Important/different key maps -------------------------- ###
# mod+q and mod+w change focus to left/right
# mod+e toggle tiling layouts and mod+t go to tabbed layout
# mod+backspace shows "System control" menu: lock screen, lockout, reboot or shutdown
# mod+shift+backspace shows menu to controll brightness, microphone and volume
# mod+m toggle mute sound, mod+, decreases sound and mod+. increases it
# Same bindings for microphone, but holding shift:
# mod+shift+m toggle mute mic, mod+shift+, decrease mic volume and mod+shift+. increases it
# mod+[ and mod+] decreases and increases brightness
# mod+enter opens alacritty
# mod+b opens firefox
# mod+r enters resize mode
# mod+hjkl changes focus, and mod+shift+hjkl resizes
# mod+f full screen toggle
# mod+shift+q closes window
# On those menus (resize mode, system control mode and vol/mic/brightness control),
# there is always plenty ways of quiting. The same command used to start the menu
# always quit it, as well as Control+C, ESC and simply the Q key. The only exception
# being the resize mode, where Q acts as H (since mod+q acts as mod+h, change focus)
# mod+shift+r restarts i3 presenving layout and sessions
# mod+shift+c reloads the configuration file
################################################################################

# Super key = Mod4
set $mod Mod4

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
font pango:monospace 9

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
# font pango:DejaVu Sans Mono 9

# The combination of xss-lock, nm-applet and pactl is a popular choice, so
# they are included here as an example. Modify as you see fit.

# xss-lock grabs a logind suspend inhibit lock and will use i3lock to lock the
# screen before suspend. Use loginctl lock-session to lock your screen.
exec --no-startup-id xss-lock --transfer-sleep-lock -- i3lock --nofork

# NetworkManager is the most popular way to manage wireless networks on Linux,
# and nm-applet is a desktop environment-independent system tray GUI for it.
exec --no-startup-id nm-applet

################
## Sytem "Numbers" (?) Need a better name
#### Volume / Microphone / Brightness
################

# set $refresh_i3_bar killall -SIGUSR1 i3blocks

# Volume (i3 blocklet must have signal=10 matching this RTMIN+10)
set $refresh_audio_icon pkill -RTMIN+10 i3blocks
bindsym XF86AudioRaiseVolume  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +10% && $refresh_audio_icon
bindsym XF86AudioLowerVolume  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -10% && $refresh_audio_icon
bindsym XF86AudioMute         exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle && $refresh_audio_icon
# ---
bindsym $mod+comma   exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -2%  && $refresh_audio_icon
bindsym $mod+period  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +2%  && $refresh_audio_icon
bindsym $mod+m       exec --no-startup-id pactl set-sink-mute   @DEFAULT_SINK@ toggle && $refresh_audio_icon

# Mic (i3 blocklet must have signal=11 matching this RTMIN+11)
set $refresh_mic_icon pkill -RTMIN+11 i3blocks
bindsym XF86AudioMicMute  exec --no-startup-id pactl set-source-mute "alsa_input.pci-0000_00_1f.3.analog-stereo"   toggle && $refresh_mic_icon
bindsym $mod+Shift+comma  exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" -2%  &&   $refresh_mic_icon
bindsym $mod+Shift+period exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" +2%  &&   $refresh_mic_icon
bindsym $mod+Shift+m      exec --no-startup-id pactl set-source-mute   "alsa_input.pci-0000_00_1f.3.analog-stereo" toggle && $refresh_mic_icon

# Brightness (i3 blocklet must have signal=12 matching this RTMIN+12)
set $refresh_brightness_icon pkill -RTMIN+12 i3blocks
bindsym $mod+bracketleft    exec xbacklight -dec 5 && $refresh_brightness_icon
bindsym $mod+bracketright   exec xbacklight -inc 5 && $refresh_brightness_icon

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# kill focused window
bindsym $mod+Shift+q kill

# start dmenu (a program launcher)
# Consider making some patches to dmenu, at least the fuzzy matcher: https://tools.suckless.org/dmenu/patches/fuzzymatch/
# The -i flag for canse insensitive
bindsym $mod+d exec --no-startup-id dmenu_run -i
# A more modern dmenu replacement is rofi:
# bindcode $mod+40 exec "rofi -modi drun,run -show drun"
# There also is i3-dmenu-desktop which only displays applications shipping a
# .desktop file. It is a wrapper around dmenu, so you need that installed.
# bindcode $mod+40 exec --no-startup-id i3-dmenu-desktop

# change focus
# bindsym $mod+ccedilla focus right
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right
bindsym $mod+q focus left
bindsym $mod+w focus right

# alternatively, you can use the cursor keys:
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# move focused window
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# split in horizontal orientation
bindsym $mod+v split h

# split in vertical orientation
bindsym $mod+s split v

# enter fullscreen mode for the focused container
bindsym $mod+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
# bindsym $mod+q layout stacking
bindsym $mod+t layout tabbed
bindsym $mod+e layout toggle split

# toggle tiling / floating
bindsym $mod+Shift+space floating toggle

# change focus between tiling / floating windows
bindsym $mod+space focus mode_toggle

# focus the parent container
bindsym $mod+a focus parent

# focus the child container
bindsym $mod+Shift+a focus child

# Define names for default workspaces for which we configure key bindings later on.
# We use variables to avoid repeating the names in multiple places.
set $ws1  "1"
set $ws2  "2"
set $ws3  "3"
set $ws4  "4"
set $ws5  "5"
set $ws6  "6"
set $ws7  "7"
set $ws8  "8"
set $ws9  "9"
set $ws10 "10"

# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
bindsym $mod+6 workspace number $ws6
bindsym $mod+7 workspace number $ws7
bindsym $mod+8 workspace number $ws8
bindsym $mod+9 workspace number $ws9
bindsym $mod+0 workspace number $ws10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number $ws1
bindsym $mod+Shift+2 move container to workspace number $ws2
bindsym $mod+Shift+3 move container to workspace number $ws3
bindsym $mod+Shift+4 move container to workspace number $ws4
bindsym $mod+Shift+5 move container to workspace number $ws5
bindsym $mod+Shift+6 move container to workspace number $ws6
bindsym $mod+Shift+7 move container to workspace number $ws7
bindsym $mod+Shift+8 move container to workspace number $ws8
bindsym $mod+Shift+9 move container to workspace number $ws9
bindsym $mod+Shift+0 move container to workspace number $ws10

# Move focused container to workspace and switch to that workspace
bindsym $mod+Control+1 move container to workspace number $ws1,  workspace $ws1
bindsym $mod+Control+2 move container to workspace number $ws2,  workspace $ws2
bindsym $mod+Control+3 move container to workspace number $ws3,  workspace $ws3
bindsym $mod+Control+4 move container to workspace number $ws4,  workspace $ws4
bindsym $mod+Control+5 move container to workspace number $ws5,  workspace $ws5
bindsym $mod+Control+6 move container to workspace number $ws6,  workspace $ws6
bindsym $mod+Control+7 move container to workspace number $ws7,  workspace $ws7
bindsym $mod+Control+8 move container to workspace number $ws8,  workspace $ws8
bindsym $mod+Control+9 move container to workspace number $ws9,  workspace $ws9
bindsym $mod+Control+0 move container to workspace number $ws10, workspace $ws10

# Go back to last workspace easily. Example:
# Hit $mod+2 to go to workspace 2, and hit it again to go to last workspace
workspace_auto_back_and_forth yes

# Move workspace to another monitor
bindsym $mod+o move workspace to output left
bindsym $mod+p move workspace to output right
# Move container to another monitor
bindsym $mod+Shift+o move container to output left
bindsym $mod+Shift+p move container to output right
# Move container to another monitor and switch to that monitor
bindsym $mod+Control+o move container to output left,  focus output left
bindsym $mod+Control+p move container to output right, focus output right

# WIP
# set $workspace_to_monitor Send workspace to left/right monitor
# bindsym $mod+Shift+p mode "$workspace_to_monitor"
# mode "$workspace_to_monitor" {
#   bindsym h move workspace to output left
#   bindsym l move workspace to output right

#   bindsym j move workspace to output left
#   bindsym k move workspace to output right

#   bindsym w move workspace to output left

#   bindsym left move workspace to output left
#   bindsym right move workspace to output right

#   bindsym Escape mode "default"
#   bindsym Control+c mode "default"
#   bindsym p mode "default"
#   bindsym q mode "default"
#   bindsym $mod+Shift+p mode "default"
# }

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
# bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'"

# Menu to quickly shutdown/restart/suspend
# set $mode_system System (l) lock, (e) logout, (s) suspend, (h) hibernate, (r) reboot, (CTRL+s) shutdown
set $mode_system Lock (l), Logout/Exit (e), Reboot (r), Shutdown (CTRL+s)

bindsym $mod+BackSpace mode "$mode_system"
mode "$mode_system" {
  bindsym l exec --no-startup-id $i3lockwall, mode "default"
  bindsym e exec --no-startup-id i3-msg exit, mode "default"
  # bindsym s exec --no-startup-id $i3lockwall && systemctl suspend, mode "default"
  # bindsym h exec --no-startup-id $i3lockwall && systemctl hibernate, mode "default"
  bindsym r exec --no-startup-id systemctl reboot, mode "default"
  bindsym Ctrl+s exec --no-startup-id systemctl poweroff -i, mode "default"

  # back to normal
  bindsym Escape mode "default"
  bindsym Ctrl+c mode "default"
  bindsym q mode "default"
  bindsym $mod+BackSpace mode "default"
}

# Create an "interactively" menu to set volume/mic/brightness
# to a "specific" number (0, 10, 20, 30, ..., 100)
# All multiples of 10 from 0 to 100
### Brightness can't be 0, it goes to 1 instead
### Select T for 10
# TODO Be able to pass exact number (maybe with dmenu)
set $mode_control_numbers Set manually: (B) Brightness, (M) Mic volume, (V) Volume
set $brightness_control (B) Enter value (will be multiplied by 10, t for ten)
set $mic_control        (M) Enter value (will be multiplied by 10, t for ten)
set $volume_control     (V) Enter value (will be multiplied by 10, t for ten)

bindsym $mod+Shift+BackSpace mode "$mode_control_numbers"
mode "$mode_control_numbers" {
  bindsym b mode "$brightness_control"
  bindsym m mode "$mic_control"
  bindsym v mode "$volume_control"

  bindsym Escape mode "default"
  bindsym Ctrl+c mode "default"
  bindsym q mode "default"
  bindsym $mod+Shift+BackSpace mode "default"
}
mode "$brightness_control" {
  bindsym 0 exec xbacklight -set 1   && $refresh_brightness_icon
  bindsym 1 exec xbacklight -set 10  && $refresh_brightness_icon
  bindsym 2 exec xbacklight -set 20  && $refresh_brightness_icon
  bindsym 3 exec xbacklight -set 30  && $refresh_brightness_icon
  bindsym 4 exec xbacklight -set 40  && $refresh_brightness_icon
  bindsym 5 exec xbacklight -set 50  && $refresh_brightness_icon
  bindsym 6 exec xbacklight -set 60  && $refresh_brightness_icon
  bindsym 7 exec xbacklight -set 70  && $refresh_brightness_icon
  bindsym 8 exec xbacklight -set 80  && $refresh_brightness_icon
  bindsym 9 exec xbacklight -set 90  && $refresh_brightness_icon
  bindsym t exec xbacklight -set 100 && $refresh_brightness_icon

  bindsym b mode "$brightness_control"
  bindsym m mode "$mic_control"
  bindsym v mode "$volume_control"

  bindsym Escape mode "default"
  bindsym Ctrl+c mode "default"
  bindsym q mode "default"
  bindsym $mod+Shift+BackSpace mode "default"
}
mode "$mic_control" {
  bindsym 0 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 0%   && $refresh_mic_icon
  bindsym 1 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 10%  && $refresh_mic_icon
  bindsym 2 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 20%  && $refresh_mic_icon
  bindsym 3 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 30%  && $refresh_mic_icon
  bindsym 4 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 40%  && $refresh_mic_icon
  bindsym 5 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 50%  && $refresh_mic_icon
  bindsym 6 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 60%  && $refresh_mic_icon
  bindsym 7 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 70%  && $refresh_mic_icon
  bindsym 8 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 80%  && $refresh_mic_icon
  bindsym 9 exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 90%  && $refresh_mic_icon
  bindsym t exec --no-startup-id pactl set-source-volume "alsa_input.pci-0000_00_1f.3.analog-stereo" 100% && $refresh_mic_icon

  bindsym b mode "$brightness_control"
  bindsym m mode "$mic_control"
  bindsym v mode "$volume_control"

  bindsym Escape mode "default"
  bindsym Ctrl+c mode "default"
  bindsym q mode "default"
  bindsym $mod+Shift+BackSpace mode "default"
}
mode "$volume_control" {
  bindsym 0  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 0%  && $refresh_audio_icon
  bindsym 1  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 10% && $refresh_audio_icon
  bindsym 2  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 20% && $refresh_audio_icon
  bindsym 3  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 30% && $refresh_audio_icon
  bindsym 4  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 40% && $refresh_audio_icon
  bindsym 5  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 50% && $refresh_audio_icon
  bindsym 6  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 60% && $refresh_audio_icon
  bindsym 7  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 70% && $refresh_audio_icon
  bindsym 8  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 80% && $refresh_audio_icon
  bindsym 9  exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 90% && $refresh_audio_icon
  bindsym t exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ 100% && $refresh_audio_icon

  bindsym b mode "$brightness_control"
  bindsym m mode "$mic_control"
  bindsym v mode "$volume_control"

  bindsym Escape mode "default"
  bindsym Ctrl+c mode "default"
  bindsym q mode "default"
  bindsym $mod+Shift+BackSpace mode "default"
}

# Wallpaper
exec sh ~/scripts/setwallpaper.sh ~/Pictures/wallpapers/wall.jpg
# Lock screen
# set $i3lockwall i3lock -i ~/Pictures/wallpapers/tux3.png -t
set $i3lockwall i3lock

# Disable notebook things
exec sh ~/scripts/disable-keyboard.sh
exec sh ~/scripts/disable-touchpad.sh

# Compositor
exec_always picom

# Meu Deus, esse barulho é muito alto! Tirar o "pc speaker", que são
# os bips quando a busca no Firfox não encontra nada, por exemplo
# Precisa de privilégios sudo pra isso, então não vai funcionar aqui.
# https://wiki.archlinux.org/title/PC_speaker
exec rmmod pcspkr

focus_follows_mouse no

# resize window (you can also use the mouse for that)
bindsym $mod+r mode "resize"
mode "resize" {
  # These bindings trigger as soon as you enter the resize mode

  # Pressing h will shrink the window’s width.
  # Pressing j will grow the window’s width.
  # Pressing k will shrink the window’s height.
  # Pressing l will grow the window’s height.
  bindsym h resize shrink width 5 px or 5 ppt
  bindsym j resize grow height 5 px or 5 ppt
  bindsym k resize shrink height 5 px or 5 ppt
  bindsym l resize grow width 5 px or 5 ppt

  bindsym q resize shrink width 5 px or 5 ppt
  bindsym w resize grow width 5 px or 5 ppt
  bindsym a resize grow height 5 px or 5 ppt
  bindsym s resize shrink height 5 px or 5 ppt

  bindsym Left resize shrink width 10 px or 10 ppt
  bindsym Down resize grow height 10 px or 10 ppt
  bindsym Up resize shrink height 10 px or 10 ppt
  bindsym Right resize grow width 10 px or 10 ppt

  # back to normal
  bindsym Escape mode "default"
  bindsym Control+c mode "default"
  # bindsym q mode "default"
  bindsym $mod+r mode "default"
}

# colors
# For the urgent background, I picked some color from here: https://encycolorpedia.com/d70a53
# This is also nice: http://paperheartdesign.com/blog/color-palette-terrific-teal
set $bgcolor    #008080
set $ibgcolor   #363636

set $textcolor  #f4f4f4
set $itextcolor #888888

set $ubgcolor   #8b1a38
# Note: Using something like $bgcolor70 will use $bgcolor with appended 70 at
#       the end. This can be useful to set transparency based on itens, and not
#       based on the variable.
# --------------------- border --- background --- text ------ indicator
client.focused          $bgcolor   $bgcolor       $textcolor  $bgcolor
client.unfocused        $ibgcolor  $ibgcolor      $itextcolor $ibgcolor
client.focused_inactive $ibgcolor  $itextcolor    $itextcolor $ibgcolor
client.urgent           $ubgcolor  $ubgcolor      $textcolor  $ubgcolor

# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
# Top bar using i3blocks (needs version 1.5 or more! Build from source if needed)
# https://github.com/vivien/i3blocks#installation
bar {
  # status_command i3status --config ~/.config/i3/i3status.conf
  status_command i3blocks -c ~/.config/i3/i3blocks.conf
  position top
  tray_output eDP1
  font pango:Font Awesome 9
  binding_mode_indicator yes
  workspace_min_width 30
  # i3bar_command i3bar --transparency
  colors {
      background #000000
      statusline #ffffff
      separator #666666

      # ---------------- border --- background -- text
      focused_workspace  $bgcolor   $bgcolor      $textcolor
      inactive_workspace $ibgcolor  $ibgcolor     $itextcolor
      urgent_workspace   $ubgcolor  $ubgcolor     $textcolor
      # binding_mode       #2f343a    #900000       #ffffff
      binding_mode       $ubgcolor  $ubgcolor     $textcolor
  }
}

# Polybar
# exec_always --no-startup-id $HOME/.config/polybar/launch.sh

# https://gist.github.com/lirenlin/9892945
# default_border pixel 1
# default_floating_border pixel 1

# "To get the class name and the instance name of a precise application’ window,
# you need to run the application itself, open a terminal and run the following:"
# xprop | grep WM_CLASS
# This results in something like WM_CLASS(STRING) = "instance", "class"
assign [instance="discord" class="discord"] 10
assign [instance="zoom" class="zoom"] 9
for_window [instance="zoom" class="zoom"] floating enable
for_window [instance="gnome-mines" class="Gnome-mines"] floating enable
for_window [instance="gedit" class="Gedit"] floating enable
for_window [window_role="pop_up"] floating enable
for_window [window_role="task_dialog"] floating enable

for_window [class="^.*"] border pixel 5
# new_window 1pixel

bindsym $mod+Return exec alacritty
bindsym $mod+b exec firefox

# Print screen with flameshot
bindsym Print exec flameshot full -c
bindsym Control+Print exec flameshot gui
bindsym Mod1+Print exec flameshot screen -c

bindsym Shift+Print exec flameshot full -p ~/Pictures/screenshots/
